"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6776],{56776:function(t,e,i){i.r(e),i.d(e,{HLSProvider:function(){return o}});var s=i(17015),n=i(39684);i(2265);let h=t=>(0,s.camelToKebabCase)(t);class a{constructor(t,e){this.m=t,this.b=e,this.d=null,this.rb=null,this.sb={},this.tb=new Set}get instance(){return this.d}setup(t){let{streamType:e}=this.b.$state,i=(0,s.peek)(e).includes("live"),h=(0,s.peek)(e).includes("ll-");this.d=new t({lowLatencyMode:h,backBufferLength:h?4:i?8:void 0,renderTextTracksNatively:!1,...this.sb});let a=this.Pi.bind(this);for(let e of Object.values(t.Events))this.d.on(e,a);for(let e of(this.d.on(t.Events.ERROR,this.R.bind(this)),this.tb))e(this.d);this.b.player.dispatch("hls-instance",{detail:this.d}),this.d.attachMedia(this.m),this.d.on(t.Events.AUDIO_TRACK_SWITCHED,this.Ri.bind(this)),this.d.on(t.Events.LEVEL_SWITCHED,this.Si.bind(this)),this.d.on(t.Events.LEVEL_LOADED,this.Ti.bind(this)),this.d.on(t.Events.NON_NATIVE_TEXT_TRACKS_FOUND,this.Ui.bind(this)),this.d.on(t.Events.CUES_PARSED,this.Vi.bind(this)),this.b.qualities[n.WX.Ja]=this.ke.bind(this),(0,s.listenEvent)(this.b.qualities,"change",this.le.bind(this)),(0,s.listenEvent)(this.b.audioTracks,"change",this.me.bind(this)),this.rb=(0,s.effect)(this.ne.bind(this))}ba(t,e){return new s.DOMEvent(h(t),{detail:e})}ne(){if(!this.b.$state.live())return;let t=new n.LK(this.oe.bind(this));return t.Ya(),t.aa.bind(t)}oe(){this.b.$state.liveSyncPosition.set(this.d?.liveSyncPosition??1/0)}Pi(t,e){this.b.player?.dispatch(this.ba(t,e))}Ui(t,e){let i=this.ba(t,e),s=-1;for(let t=0;t<e.tracks.length;t++){let h=e.tracks[t],a=h.subtitleTrack??h.closedCaptions,r=new n.n8({id:`hls-${h.kind}-${t}`,src:a?.url,label:h.label,language:a?.lang,kind:h.kind,default:h.default});r[n.kA.na]=2,r[n.kA.ib]=()=>{"showing"===r.mode?(this.d.subtitleTrack=t,s=t):s===t&&(this.d.subtitleTrack=-1,s=-1)},this.b.textTracks.add(r,i)}}Vi(t,e){let i=this.d?.subtitleTrack,s=this.b.textTracks.getById(`hls-${e.type}-${i}`);if(!s)return;let n=this.ba(t,e);for(let t of e.cues)t.positionAlign="auto",s.addCue(t,n)}Ri(t,e){let i=this.b.audioTracks[e.id];if(i){let s=this.ba(t,e);this.b.audioTracks[n.HV.fa](i,!0,s)}}Si(t,e){let i=this.b.qualities[e.level];if(i){let s=this.ba(t,e);this.b.qualities[n.HV.fa](i,!0,s)}}Ti(t,e){if(this.b.$state.canPlay())return;let{type:i,live:h,totalduration:a,targetduration:r}=e.details,d=this.ba(t,e);this.b.delegate.c("stream-type-change",h?"EVENT"===i&&Number.isFinite(a)&&r>=10?"live:dvr":"live":"on-demand",d),this.b.delegate.c("duration-change",a,d);let l=this.d.media;for(let t of(-1===this.d.currentLevel&&this.b.qualities[n.WX.Xa](!0,d),this.d.audioTracks)){let e={id:t.id.toString(),label:t.name,language:t.lang||"",kind:"main"};this.b.audioTracks[n.HV.ea](e,d)}for(let t of this.d.levels){let e={id:t.id?.toString()??t.height+"p",width:t.width,height:t.height,codec:t.codecSet,bitrate:t.bitrate};this.b.qualities[n.HV.ea](e,d)}l.dispatchEvent(new s.DOMEvent("canplay",{trigger:d}))}R(t,e){e.fatal&&("mediaError"===e.type?this.d?.recoverMediaError():this.rc(e.error))}rc(t){this.b.delegate.c("error",{message:t.message,code:1,error:t})}ke(){this.d&&(this.d.currentLevel=-1)}le(){let{qualities:t}=this.b;this.d&&!t.auto&&(this.d[t.switch+"Level"]=t.selectedIndex,n.G9&&(this.m.currentTime=this.m.currentTime))}me(){let{audioTracks:t}=this.b;this.d&&this.d.audioTrack!==t.selectedIndex&&(this.d.audioTrack=t.selectedIndex)}Wi(t){(0,s.isString)(t.src)&&this.d?.loadSource(t.src)}Xi(){this.d?.destroy(),this.d=null,this.rb?.(),this.rb=null}}class r{constructor(t,e,i){this.M=t,this.b=e,this.Ma=i,this.re()}async re(){let t={onLoadStart:this.Na.bind(this),onLoaded:this.ub.bind(this),onLoadError:this.se.bind(this)},e=await l(this.M,t);return((0,s.isUndefined)(e)&&!(0,s.isString)(this.M)&&(e=await d(this.M,t)),e)?e.isSupported()?e:(this.b.player.dispatch(new s.DOMEvent("hls-unsupported")),this.b.delegate.c("error",{message:"[vidstack] `hls.js` is not supported in this environment",code:4}),null):null}Na(){this.b.player.dispatch(new s.DOMEvent("hls-lib-load-start"))}ub(t){this.b.player.dispatch(new s.DOMEvent("hls-lib-loaded",{detail:t})),this.Ma(t)}se(t){let e=(0,n.DR)(t);this.b.player.dispatch(new s.DOMEvent("hls-lib-load-error",{detail:e})),this.b.delegate.c("error",{message:e.message,code:4,error:e})}}async function d(t,e={}){if(!(0,s.isUndefined)(t)){if(e.onLoadStart?.(),t.prototype&&t.prototype!==Function)return e.onLoaded?.(t),t;try{let i=(await t())?.default;if(i&&i.isSupported)e.onLoaded?.(i);else throw Error("");return i}catch(t){e.onLoadError?.(t)}}}async function l(t,e={}){if((0,s.isString)(t)){e.onLoadStart?.();try{if(await (0,n.ve)(t),!(0,s.isFunction)(window.Hls))throw Error("");let i=window.Hls;return e.onLoaded?.(i),i}catch(t){e.onLoadError?.(t)}}}class o extends n.G6{constructor(){super(...arguments),this.$$PROVIDER_TYPE="HLS",this.sc=null,this.e=new a(this.video,this.b),this.pa="https://cdn.jsdelivr.net/npm/hls.js@^1.5.0/dist/hls.min.js"}get ctor(){return this.sc}get instance(){return this.e.instance}get type(){return"hls"}get canLiveSync(){return!0}get config(){return this.e.sb}set config(t){this.e.sb=t}get library(){return this.pa}set library(t){this.pa=t}preconnect(){(0,s.isString)(this.pa)&&(0,n.$P)(this.pa)}setup(){super.setup(),new r(this.pa,this.b,t=>{this.sc=t,this.e.setup(t),this.b.delegate.c("provider-setup",this);let e=(0,s.peek)(this.b.$state.source);e&&this.loadSource(e)})}async loadSource(t,e){if(!(0,s.isString)(t.src)){this.pc();return}this.a.preload=e||"",this.he(t,"application/x-mpegurl"),this.e.Wi(t),this.L=t}onInstance(t){let e=this.e.instance;return e&&t(e),this.e.tb.add(t),()=>this.e.tb.delete(t)}destroy(){this.e.Xi()}}o.supported=(0,n.tF)()}}]);